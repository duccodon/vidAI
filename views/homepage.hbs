<div class="fixed top-[3.8rem] sm:top-[5.4rem] left-[100px] h-[calc(100vh-5*1vh-3.8rem)] sm:h-[calc(100vh-5*1vh-7rem)] md:h-[calc(100vh-5*1vh-2rem)] w-[100%] md:w-[93%] bg-white rounded-[1rem] border border-[#ccc] overflow-y-auto overflow-x-hidden z-3">
  <div id="firstPage" class="mx-4 my-auto items-center gap-[1rem] py-[1rem] md:flex hidden">
    <img
    src="data:image/jpeg;base64,{{currentUser.profile_picture}}"
    class="min-w-[2.5rem] min-h-[2.5rem] max-w-[2.5rem] max-h-[2.5rem] rounded-[50%] overflow-hidden"
    />
    <div class="flex flex-row gap-4 items-start md:items-center w-full">
      <textarea id="insertTopic"
      class="flex-grow w-full md:w-auto pl-4 text-[13px] bg-[#FAFAFA] rounded-[2rem] px-[.5rem] py-[.5rem]"
      placeholder="What's on your mind?" rows="1"
      oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px';"></textarea>
      <div class="flex flex-wrap gap-4 items-center text-[13px]">
        <label class="flex items-center gap-1">
          <input type="radio" name="duration" value="1 min" class="accent-black" checked />
          <span>Short (1 min)</span>
        </label>
        <label class="flex items-center gap-1">
          <input type="radio" name="duration" value="3 min" class="accent-black" />
          <span>Medium (3 min)</span>
        </label>
        <label class="flex items-center gap-1">
          <input type="radio" name="duration" value="5 min+" class="accent-black" />
          <span>Long (5 min+)</span>
        </label>
      </div>
    </div>
    <div
      id="postButton"
      class="plus-button inline-block px-[2rem] py-[.6rem] font-medium cursor-pointer transition ease-in-out duration-300 text-sm hover:opacity-80 bg-white text-black border border-black border-solid rounded-[.7rem]">
      Next
    </div>
  </div>


  <!-- Section to choose bot and style -->
  <div class="fixed top-[3.8rem] sm:top-[5.4rem] left-[100px] h-[calc(100vh-5*1vh-3.8rem)] sm:h-[calc(100vh-5*1vh-7rem)] md:h-[calc(100vh-5*1vh-2rem)] w-[100%] md:w-[93%] bg-white rounded-[1rem] border border-[#ccc] overflow-y-auto overflow-x-hidden z-3" id="secondPage" style="display: none;">
    <div class="flex flex-row justify-between mx-4 my-auto gap-[3rem] py-[1rem]">
      <div class="flex items-center">
        <div id="returnTopicBtn" class="inline-block px-[2rem] py-[.6rem] font-medium cursor-pointer transition ease-in-out duration-300 text-sm hover:opacity-80 bg-white text-black border border-black border-solid rounded-[.7rem] mt-4">
          Back
        </div>
      </div>

      <div>
        <div class="text-[20px] font-medium">Select Chatbot</div>
        <div class="flex flex-col gap-2">
          <label>
            <input type="radio" name="chatbot" value="Gemini" class="accent-black" checked />
            Gemini
          </label>
          <label>
            <input type="radio" name="chatbot" value="OpenAI" class="accent-black" />
            OpenAI
          </label>
          <label>
            <input type="radio" name="chatbot" value="Groq" class="accent-black" />
            Groq
          </label>
          <label>
            <input type="radio" name="chatbot" value="DeepSeek" class="accent-black" />
            DeepSeek
          </label>
        </div>
      </div>

      <div>
        <div class="text-[20px] font-medium">Select Writing Style</div>
        <div class="flex flex-col gap-2">
          <label>
            <input type="radio" name="writingStyle" value="child" class="accent-black" />
            Child
          </label>
          <label>
            <input type="radio" name="writingStyle" value="adult" class="accent-black" />
            Adult
          </label>
          <label>
            <input type="radio" name="writingStyle" value="professional" class="accent-black" />
            Professional
          </label>
          <label class="flex items-center gap-2">
            <input type="radio" name="writingStyle" value="custom" class="accent-black" id="customStyleRadio" />
            Other:
            <input type="text" id="customStyleInput" class="border px-2 py-1 rounded text-sm"
              placeholder="Enter custom style" />
          </label>
        </div>
      </div>

      
      <div class="flex items-center">
        <div id="nextButton" class="plus-button inline-block px-[2rem] py-[.6rem] font-medium cursor-pointer transition ease-in-out duration-300 text-sm hover:opacity-80 bg-white text-black border border-black border-solid rounded-[.7rem] mt-4">
          Next
        </div>
      </div>
    </div>
    <div class="flex flex-row justify-between min-h-[150px] h-[600px]">
      <div class="black flex justify-center w-full mt-4">
        <textarea id="scriptDisplay"
          class="scrollbar px-6 py-4 text-base text-center border border-black rounded-md min-h-[150px] w-[95%] max-w-[800px]"
          style="resize: vertical; white-space: pre-wrap;"
          placeholder="Your script will be displayed here..." readonly
        ></textarea>
      </div>

      <div class="flex justify-center items-center mr-4">
        <button id="finishScriptBtn"
          class="plus-button inline-block px-[2rem] py-[.6rem] font-medium cursor-pointer transition ease-in-out duration-300 text-sm hover:opacity-80 bg-white text-black border border-black border-solid rounded-[.7rem]">
          Finish Script
        </button>
      </div>
    </div>
  </div>


  <!-- Section to gen audio -->
  <div id="thirdPage" style="display: none;" class="fixed top-[3.8rem] sm:top-[5.4rem] left-[100px] h-[calc(100vh-5*1vh-3.8rem)] sm:h-[calc(100vh-5*1vh-7rem)] md:h-[calc(100vh-5*1vh-2rem)] w-[100%] md:w-[93%] bg-white rounded-[1rem] border border-[#ccc] overflow-y-auto overflow-x-hidden z-3">
    <div class="text-2xl font-bold">You're now on the next step after finishing the script!</div>
    <div class="flex flex-row justify-between mx-4 my-auto gap-[3rem] py-[1rem]">
      <div class="flex items-center">
        <div id="returnScriptBtn" class="inline-block px-[2rem] py-[.6rem] font-medium cursor-pointer transition ease-in-out duration-300 text-sm hover:opacity-80 bg-white text-black border border-black border-solid rounded-[.7rem] mt-4">
          Back
        </div>
      </div>

      <div>
        test
      </div>

      <div>
        <div class="text-[20px] font-medium">Select Writing Style</div>
      </div>

      <div class="flex items-center">
        <div id="audioButton" class="plus-button inline-block px-[2rem] py-[.6rem] font-medium cursor-pointer transition ease-in-out duration-300 text-sm hover:opacity-80 bg-white text-black border border-black border-solid rounded-[.7rem] mt-4">
          Next
        </div>
      </div>
    </div>
  </div>

  <div class="mx-4 my-auto items-center gap-[1rem] py-[1rem] text-[25px]">Hot topics</div>
  <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5 gap-6 p-4">
    <div class="flex flex-col">
      <div class="w-full aspect-[4/3] bg-gray-200 rounded-lg overflow-hidden shadow" onclick="chooseTopic('Geology')">
        <img src="/img/assets/vidAILogo.png" alt="Preview" class="w-full h-full object-cover" />
      </div>
      <div class="flex justify-center mt-2 text-[15px] font-medium text-black truncate">Geology</div>
    </div>

    <div class="flex flex-col">
      <div class="w-full aspect-[4/3] bg-gray-200 rounded-lg overflow-hidden shadow" onclick="chooseTopic('Physics')">
        <img src="/img/assets/vidAILogo.png" alt="Preview" class="w-full h-full object-cover" />
      </div>
      <div class="flex justify-center mt-2 text-[15px] font-medium text-black truncate">Physics</div>
    </div>

    <div class="flex flex-col">
      <div class="w-full aspect-[4/3] bg-gray-200 rounded-lg overflow-hidden shadow" onclick="chooseTopic('Chemistry')">
        <img src="/img/assets/vidAILogo.png" alt="Preview" class="w-full h-full object-cover" />
      </div>
      <div class="flex justify-center mt-2 text-[15px] font-medium text-black truncate">Chemistry</div>
    </div>

    <div class="flex flex-col">
      <div class="w-full aspect-[4/3] bg-gray-200 rounded-lg overflow-hidden shadow" onclick="chooseTopic('Biology')">
        <img src="/img/assets/vidAILogo.png" alt="Preview" class="w-full h-full object-cover" />
      </div>
      <div class="flex justify-center mt-2 text-[15px] font-medium text-black truncate">Biology</div>
    </div>

    <div class="flex flex-col">
      <div class="w-full aspect-[4/3] bg-gray-200 rounded-lg overflow-hidden shadow" onclick="chooseTopic('Animal')">
        <img src="/img/assets/vidAILogo.png" alt="Preview" class="w-full h-full object-cover" />
      </div>
      <div class="flex justify-center mt-2 text-[15px] font-medium text-black truncate">Animal</div>
    </div>

    <div class="flex flex-col">
      <div class="w-full aspect-[4/3] bg-gray-200 rounded-lg overflow-hidden shadow" onclick="chooseTopic('War')">
        <img src="/img/assets/vidAILogo.png" alt="Preview" class="w-full h-full object-cover" />
      </div>
      <div class="flex justify-center mt-2 text-[15px] font-medium text-black truncate">War</div>
    </div>
  </div>


</div>

<script>
  const customRadio = document.getElementById("customStyleRadio");
  const customInput = document.getElementById("customStyleInput");

  // Disable input by default
  customInput.disabled = true;

  document.querySelectorAll('input[name="writingStyle"]').forEach(radio => {
    radio.addEventListener("change", () => {
      customInput.disabled = customRadio.checked ? false : true;
    });
  });

  document.getElementById("returnTopicBtn").addEventListener("click", function () {
    document.getElementById("secondPage").style.display = "none";
  });

  document.getElementById("returnScriptBtn").addEventListener("click", function () {
    document.getElementById("thirdPage").style.display = "none";
  });

  document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("postButton").addEventListener("click", async function () {
      const topic = document.getElementById("insertTopic").value.trim();
      const duration = document.querySelector('input[name="duration"]:checked').value;

      if (!topic) {
        alert("Please enter a topic.");
        return;
      }
      if (!duration) {
        alert("Please select a duration.");
        return;
      }

      document.getElementById("secondPage").style.display = "block";

      // Pass the topic and duration to the next page as needed
      window.currentTopic = topic;
      window.currentDuration = duration;
    });

    // Handle second "Next" button click
    document.getElementById("nextButton").addEventListener("click", async function () {
      const selectedChatbot = document.querySelector('input[name="chatbot"]:checked')?.value;
      let selectedWritingStyles = document.querySelector('input[name="writingStyle"]:checked')?.value;
      const customInput = document.getElementById("customStyleInput");

      if (!selectedChatbot) {
        alert("Please select a chatbot.");
        return;
      }
      if (!selectedWritingStyles) {
        alert("Please select a writing style.");
        return;
      }
      console.log("Selected Chatbot:", selectedChatbot);
      console.log("Selected Writing Styles:", selectedWritingStyles);

      if (selectedWritingStyles === "custom") {
        const customStyle = customInput.value.trim();
        if (!customStyle) {
          alert("Please enter a custom writing style.");
          return;
        }
        selectedWritingStyles = customStyle;
      }

      const scriptDisplay = document.getElementById("scriptDisplay");
      scriptDisplay.setAttribute("readonly", "true"); 
      try {
        scriptDisplay.textContent = "In process...";

        const res = await fetch("/homepage/api/generate-script", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            topic: window.currentTopic,
            duration: window.currentDuration,
            chatbot: selectedChatbot,
            writingStyles: selectedWritingStyles,
          }),
        });

        const data = await res.json();
        
        if (data.success) {
          scriptDisplay.textContent = data.script;
          scriptDisplay.removeAttribute("readonly"); 
          scriptDisplay.scrollIntoView({ behavior: "smooth" }); // Optional: scroll to it
        }else {
          scriptDisplay.textContent = "Error: " + data.message;
        }
      } catch (err) {
        console.error(err);
      }
    });


    //Handle finish script button click
    document.getElementById("finishScriptBtn").addEventListener("click", async function () {
      const script = document.getElementById("scriptDisplay").value.trim();
      if (!script) {
        alert("Please generate a script first.");
        return;
      }

      document.getElementById("thirdPage").style.display = "block";

      try {
        const res = await fetch("/homepage/api/generate-audio", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            script: script,
          }),
        });

        const data = await res.json();
        
        if (data.success) {
          console.log("Audio generated successfully:", data.audioUrl);
        } else {
          console.error("Error generating audio:", data.message);
        }
      }catch (err) {
        console.error(err);
      }
      // Redirect to the next page or perform any action you want
      //window.location.href = "/homepage/gen-audio";
    });
  });


  function chooseTopic(topic) {
    console.log("Topic chosen:", topic);
  }
</script>